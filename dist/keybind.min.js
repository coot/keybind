/*!
 * Copyright (c) 2016 Rubble LTD. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE
 * OR OTHER DEALINGS IN THE SOFTWARE.
 */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){"function"==typeof require&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e():"function"==typeof define&&define.amd?define([],e):e()}(function(){function e(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n].key)return!1;return!0}function t(e){var t=e.key;return"Esc"===t?"Escape":t}var n={_indexOf:function(e){for(var t=0,n=this._stack.length;t<n;t++)if(this._stack[t].key===e)return t;return-1},_keyDownListener:function(e){this._stack=this._stack.filter(function(t){return t!==e.key});var n=t(e);if("Alt"===n||e.altKey||"Meta"==e.key||e.metaKey||"Control"===e.key||e.ctrlKey)return void this._stack.splice(0,this._stack.length);this._stack.push({key:n,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey}),this._debug&&console.log("keydown",this._stack.map(function(e){return e.key}));var i=document.createEvent("CustomEvent");i.initCustomEvent("keybinding",!1,!1,Array.prototype.slice.call(this._stack)),document.body.dispatchEvent(i)},_keyUpListener:function(e){this._stack=this._stack.filter(function(n){return n.key!==t(e)});var n="Alt"===evKey,i="Control"===evKey,s="Meta"===evKey,r="Shift"===evKey;if((n||i||s||r)&&(this._stack=this._stack.filter(function(e){var t=n&&!e.altKey||i&&!e.ctrlKey||s&&!e.metaKey||r&&!e.shiftKey;return t})),"AltGraph"===evKey||"Compose"===evKey){var o=this._indexOf("AltGraph"),y=this._indexOf("Compose"),a=void 0;a=o!==-1&&y!==-1?Math.min(o,y):o!==-1?o:y!==-1?y:0,this._stack.splice(a,this._stack.length-a)}({key:evKey,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey});this._debug&&console.log("keyup",evKey,this._stack.length)},_keyBindingListener:function(t){var n=this;this._handlers.forEach(function(i){e(i.keys,t.detail)&&(i.handler(t),i.options.clearKeyStack&&n.clearStack())})},enable:function(){document.body.addEventListener("keyup",this._keyUpListener,!1),document.body.addEventListener("keydown",this._keyDownListener,!1),document.body.addEventListener("keybinding",this._keyBindingListener,!1)},disable:function(){document.body.removeEventListener("keyup",this._keyUpListener),document.body.removeEventListener("keydown",this._keyDownListener),document.body.removeEventListener("keybinding",this._keyBindingListener)},addEventListener:function(e,t,n){n=n||{clearKeyStack:!1},n.clearKeyStack=!!n.clearKeyStack,this._handlers.push({keys:e,handler:t,options:n})},removeEventListener:function(e){this._handlers=this._handlers.filter(function(t){var n=t.keys,i=!1;if(n.length===e.length){i=!0;for(var s=0,r=e.length;s<r;s++)if(n[s]!==e[s]){i=!1;break}}return!i})},clearStack:function(){this._stack.splice(0,this._stack.length)},reset:function(){this.clearStack(),this._handlers.splice(0,this._handlers.length)},dispose:function(){this.reset(),this.disable()}},i=Object.create(n,{_stack:{value:[],writable:!0},_handlers:{value:[],writable:!0},_debug:{value:!1,writable:!0}});return i._keyUpListener=i._keyUpListener.bind(i),i._keyDownListener=i._keyDownListener.bind(i),i._keyBindingListener=i._keyBindingListener.bind(i),i});