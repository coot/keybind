/*!
 * Copyright (c) 2016 Rubble LTD. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE
 * OR OTHER DEALINGS IN THE SOFTWARE.
 */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){"function"==typeof require&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e():"function"==typeof define&&define.amd?define([],e):e()}(function(){function e(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n].key)return!1;return!0}var t={_indexOf:function(e){for(var t=0,n=this._stack.length;t<n;t++)if(this._stack[t].key===e)return t;return-1},_keyDownListener:function(e){if(this._stack=this._stack.filter(function(t){return t!==e.key}),"Alt"===e.key||e.altKey||"Meta"==e.key||e.metaKey||"Control"===e.key||e.ctrlKey)return void this._stack.splice(0,this._stack.length);this._stack.push({key:e.key,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey}),this._debug&&console.log("keydown",this._stack.map(function(e){return e.key}));var t=document.createEvent("CustomEvent");t.initCustomEvent("keybinding",!1,!1,Array.prototype.slice.call(this._stack)),document.body.dispatchEvent(t)},_keyUpListener:function(e){this._stack=this._stack.filter(function(t){return t.key!==e.key});var t="Alt"===e.key,n="Control"===e.key,i="Meta"===e.key,s="Shift"===e.key;if((t||n||i||s)&&(this._stack=this._stack.filter(function(e){var r=t&&!e.altKey||n&&!e.ctrlKey||i&&!e.metaKey||s&&!e.shiftKey;return r})),"AltGraph"===e.key||"Compose"===e.key){var r=this._indexOf("AltGraph"),o=this._indexOf("Compose"),y=void 0;y=r!==-1&&o!==-1?Math.min(r,o):r!==-1?r:o!==-1?o:0,this._stack.splice(y,this._stack.length-y)}({key:e.key,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey});this._debug&&console.log("keyup",e.key,this._stack.length)},_keyBindingListener:function(t){var n=this;this._handlers.forEach(function(i){e(i.keys,t.detail)&&(i.handler(t),i.options.clearKeyStack&&n.clearStack())})},enable:function(){document.body.addEventListener("keyup",this._keyUpListener,!1),document.body.addEventListener("keydown",this._keyDownListener,!1),document.body.addEventListener("keybinding",this._keyBindingListener,!1)},disable:function(){document.body.removeEventListener("keyup",this._keyUpListener),document.body.removeEventListener("keydown",this._keyDownListener),document.body.removeEventListener("keybinding",this._keyBindingListener)},addEventListener:function(e,t,n){n=n||{clearKeyStack:!1},n.clearKeyStack=!!n.clearKeyStack,this._handlers.push({keys:e,handler:t,options:n})},removeEventListener:function(e){this._handlers=this._handlers.filter(function(t){var n=t.keys,i=!1;if(n.length===e.length){i=!0;for(var s=0,r=e.length;s<r;s++)if(n[s]!==e[s]){i=!1;break}}return!i})},clearStack:function(){this._stack.splice(0,this._stack.length)},reset:function(){this.clearStack(),this._handlers.splice(0,this._handlers.length)},dispose:function(){this.reset(),this.disable()}},n=Object.create(t,{_stack:{value:[],writable:!0},_handlers:{value:[],writable:!0},_debug:{value:!1,writable:!0}});return n._keyUpListener=n._keyUpListener.bind(n),n._keyDownListener=n._keyDownListener.bind(n),n._keyBindingListener=n._keyBindingListener.bind(n),n});