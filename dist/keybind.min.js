/*!
 * Copyright (c) 2016 Rubble LTD. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE
 * OR OTHER DEALINGS IN THE SOFTWARE.
 */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){"function"==typeof require&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e():"function"==typeof define&&define.amd?define([],e):e()}(function(){function e(e,t){if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n].key)return!1;return!0}function t(e){var t=e.key;return"Esc"===t?"Escape":"Spacebar"===t?" ":t}var n=["Alt","Meta","Control","F1","F3","F5","F6","F7","F10","F11"],i={_indexOf:function(e){for(var t=0,n=this._stack.length;t<n;t++)if(this._stack[t].key===e)return t;return-1},_keyDownListener:function(e){var i=t(e);if(this._stack=this._stack.filter(function(e){return e!==i}),n.indexOf(i)!==-1||e.altKey||e.metaKey||e.ctrlKey)return void this._stack.splice(0,this._stack.length);this._stack.push({key:i,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey}),this._debug&&console.log("keydown",this._stack.map(function(e){return e.key}));var r=document.createEvent("CustomEvent");r.initCustomEvent("keybinding",!1,!1,Array.prototype.slice.call(this._stack)),document.body.dispatchEvent(r)},_keyUpListener:function(e){var n=t(e);if("Unidentified"===n)return this.clearKeyStack();this._stack=this._stack.filter(function(e){return e.key!==n});var i="Alt"===n,r="Control"===n,s="Meta"===n,o="Shift"===n;if((i||r||s||o)&&(this._stack=this._stack.filter(function(e){var t=i&&!e.altKey||r&&!e.ctrlKey||s&&!e.metaKey||o&&!e.shiftKey;return t})),"AltGraph"===n||"Compose"===n){var a=this._indexOf("AltGraph"),c=this._indexOf("Compose"),l=void 0;l=a!==-1&&c!==-1?Math.min(a,c):a!==-1?a:c!==-1?c:0,this._stack.splice(l,this._stack.length-l)}this._debug&&console.log("keyup",n,this._stack.length)},_keyBindingListener:function(t){var n=this;this._handlers.forEach(function(i){e(i.keys,t.detail)&&(i.handler(t),i.options.clearKeyStack&&n.clearStack())})},enable:function(){this.clearStack(),document.body.addEventListener("keyup",this._keyUpListener,!1),document.body.addEventListener("keydown",this._keyDownListener,!1),document.body.addEventListener("keybinding",this._keyBindingListener,!1)},disable:function(){this.clearStack(),document.body.removeEventListener("keyup",this._keyUpListener),document.body.removeEventListener("keydown",this._keyDownListener),document.body.removeEventListener("keybinding",this._keyBindingListener)},addEventListener:function(e,t,n){n=n||{clearKeyStack:!1},n.clearKeyStack=!!n.clearKeyStack,this._handlers.push({keys:e,handler:t,options:n})},removeEventListener:function(e,t){this._handlers=this._handlers.filter(function(n){var i=n.keys,r=!1;if(e&&i.length===e.length){r=!0;for(var s=0,o=e.length;s<o;s++)if(i[s]!==e[s]){r=!1;break}}return!r||n.handler===t})},clearStack:function(){this._stack.splice(0,this._stack.length)},reset:function(){this.clearStack(),this._handlers.splice(0,this._handlers.length)},dispose:function(){this.reset(),this.disable()}},r=Object.create(i,{_stack:{value:[],writable:!0},_handlers:{value:[],writable:!0},_debug:{value:!1,writable:!0}});return r._keyUpListener=r._keyUpListener.bind(r),r._keyDownListener=r._keyDownListener.bind(r),r._keyBindingListener=r._keyBindingListener.bind(r),r});