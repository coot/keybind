/*!
 * Copyright (c) 2016 Rubble LTD. All rights reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
 * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE
 * OR OTHER DEALINGS IN THE SOFTWARE.
 */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){"function"==typeof require&&"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=e():"function"==typeof define&&define.amd?define([],e):e()}(function(){function e(e,t){if(e.length!==t.length)return!1;for(var i=0,n=e.length;i<n;i++)if(e[i]!==t[i].key)return!1;return!0}function t(e){var t=e.key;return"Esc"===t?"Escape":"Spacebar"===t?" ":t}var i=["Alt","Meta","Control","F1","F3","F5","F6","F7","F10","F11"],n={_indexOf:function(e){for(var t=0,i=this._stack.length;t<i;t++)if(this._stack[t].key===e)return t;return-1},_keyDownListener:function(e){var n=t(e);if(this._stack=this._stack.filter(function(e){return e!==n}),i.indexOf(n)!==-1||e.altKey||e.metaKey||e.ctrlKey)return void this._stack.splice(0,this._stack.length);this._stack.push({key:n,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey}),this._lastKeyDownTime=Date.now(),this._timeoutId&&clearTimeout(this._timeoutId),this.clearStackTimeout&&(this._timeoutId=setTimeout(this._clearStackCallback.bind(this),this.clearStackTimeout)),this._debug&&console.log("keydown",this._stack.map(function(e){return e.key}));var s=document.createEvent("CustomEvent");s.initCustomEvent("keybinding",!1,!1,Array.prototype.slice.call(this._stack)),document.body.dispatchEvent(s)},_keyUpListener:function(e){var i=t(e);if("Unidentified"===i)return this.clearKeyStack();this._stack=this._stack.filter(function(e){return e.key!==i});var n="Alt"===i,s="Control"===i,r="Meta"===i,a="Shift"===i;if((n||s||r||a)&&(this._stack=this._stack.filter(function(e){var t=n&&!e.altKey||s&&!e.ctrlKey||r&&!e.metaKey||a&&!e.shiftKey;return t})),"AltGraph"===i||"Compose"===i){var o=this._indexOf("AltGraph"),c=this._indexOf("Compose"),l=void 0;l=o!==-1&&c!==-1?Math.min(o,c):o!==-1?o:c!==-1?c:0,this._stack.splice(l,this._stack.length-l)}this._debug&&console.log("keyup",i,this._stack.length,this._timeoutId&&0===this._stack.length?"clearing this._timeoutId":""),0===this._stack.length&&this._timeoutId&&clearTimeout(this._timeoutId)},_keyBindingListener:function(t){var i=this;this._handlers.forEach(function(n){e(n.keys,t.detail)&&(n.handler(t),n.options.clearKeyStack&&i.clearStack())})},_clearStackCallback:function(){this._timeoutId=null,this._debug&&console.log("_clearStackCallback"),this._stack.length>0&&Date.now()-this._lastKeyDownTime>this.clearStackTimeout&&this.clearStack()},enable:function(){this.clearStack(),document.body.addEventListener("keyup",this._keyUpListener,!1),document.body.addEventListener("keydown",this._keyDownListener,!1),document.body.addEventListener("keybinding",this._keyBindingListener,!1)},disable:function(){this.clearStack(),document.body.removeEventListener("keyup",this._keyUpListener),document.body.removeEventListener("keydown",this._keyDownListener),document.body.removeEventListener("keybinding",this._keyBindingListener)},addEventListener:function(e,t,i){i=i||{clearKeyStack:!1},i.clearKeyStack=!!i.clearKeyStack,this._handlers.push({keys:e,handler:t,options:i})},removeEventListener:function(e,t){this._handlers=this._handlers.filter(function(i){var n=i.keys,s=!1;if(e&&n.length===e.length){s=!0;for(var r=0,a=e.length;r<a;r++)if(n[r]!==e[r]){s=!1;break}}return!s||i.handler===t})},clearStack:function(){this._stack.splice(0,this._stack.length),this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null)},reset:function(){this.clearStack(),this._handlers.splice(0,this._handlers.length)},dispose:function(){this.reset(),this.disable()}},s=Object.create(n,{clearStackTimeout:{value:750,writable:!0},_stack:{value:[],writable:!0},_handlers:{value:[],writable:!0},_debug:{value:!1,writable:!0},_timeoutId:{value:null,writable:!0},_lastKeyDownTime:{value:0,writable:!0}});return s._keyUpListener=s._keyUpListener.bind(s),s._keyDownListener=s._keyDownListener.bind(s),s._keyBindingListener=s._keyBindingListener.bind(s),s});